<!DOCTYPE html>
<!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if !IE] -->
<html lang='en'>
  <!-- <![endif] -->
  <head>
    <title>AutoDevbot</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <!--[if IE]> <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'> <![endif]-->
    <link href='assets/images/meta_icons/favicon.ico' rel='shortcut icon' type='image/x-icon'>
    <link href='assets/images/meta_icons/apple-touch-icon.png' rel='apple-touch-icon-precomposed'>
    <!-- / required stylesheets -->
    <link href="assets/stylesheets/bootstrap/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" />
    <link href="assets/stylesheets/dashboard.css" media="all" id="colors" rel="stylesheet" type="text/css" />    
    <link href="assets/stylesheets/jednotka_green.css" media="all" id="colors" rel="stylesheet" type="text/css" />
    <!--[if lt IE 9]>
      <script src="assets/javascripts/ie/html5shiv.js" type="text/javascript"></script>
      <script src="assets/javascripts/ie/respond.min.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body class=''>
    <div id='wrapper'>
      <header id='header'>
        <div class='container'>
          <nav class='navbar navbar-default' id='nav' role='navigation'>
            <div class='navbar-header'>
              <button class='navbar-toggle' data-target='.navbar-header-collapse' data-toggle='collapse' type='button'>
                <span class='sr-only'>Toggle navigation</span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
              </button>
              <a class='navbar-brand' href='dashboard.html'>
                <img alt="AutoDevBotLogo" src="assets/images/AutoDevBot.com_logo.png" />
              </a>
            </div>
          </nav>
        </div>
      </header>
      <div id='main' role='main'>
        <div id='main-content'>
          <div class='container'>

            <div class='row'>
              <div class='col-sm-12'>
                <div class='row chart'>
                  <div class='col-sm-12'>
                    <div id="realtimechart" style="height:190px;"></div>
                    <div id="statsChart"></div>                 
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div class='fade' id='scroll-to-top'>
          <i class='fa-icon-chevron-up'></i>
        </div>
      </div>
      <footer id='footer'>
        <div id='footer-main'>
          <div class='container'>
            <div class='row'>
              <div class='col-md-3 col-sm-6 info-box'>
                <div class='logo-container'>
                  <img alt="AutoDevBotLogo" width="217" height="55" src="assets/images/AutoDevBot.com_logo.png" />
                </div>
                <p class='no-mg-b'>We are avid DevOps people making automated tools to make our lives easier and hopefully making your lives easier also.</p>
              </div>
              <div class='col-md-3 col-sm-6 info-box'>
              </div>
              <div class='col-md-3 col-sm-6 info-box social-box'>
              </div>
              <div class='col-md-3 col-sm-6 info-box'>
              </div>
            </div>
          </div>
        </div>
        <div id='footer-copyright'>
          <div class='container'>
            <div class='row'>
              <div class='col-lg-12 clearfix'>
                <p class='copyright'>
                  Copyright
                  &copy;
                  2013 AutoDevBot
                </p>
                <div class='links'>
                  <a class='btn btn-circle btn-medium-light btn-sm' href='#'>
                    <i class='fa-icon-twitter text-dark'></i>
                  </a>
                  <a class='btn btn-circle btn-medium-light btn-sm' href='#'>
                    <i class='fa-icon-dribbble text-dark'></i>
                  </a>
                  <a class='btn btn-circle btn-medium-light btn-sm' href='#'>
                    <i class='fa-icon-facebook text-dark'></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <!-- / required javascripts -->
    <script src="assets/javascripts/jquery/jquery.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/jquery/jquery.mobile.custom.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/bootstrap/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/plugins/modernizr/modernizr.custom.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/plugins/hover_dropdown/twitter-bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/plugins/validate/jquery.validate.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/jednotka.js" type="text/javascript"></script>
    <!-- flot charts -->
    <script src="assets/javascripts/plugins/flot/jquery.flot.js"></script>
    <script src="assets/javascripts/plugins/flot/jquery.flot.stack.js"></script>
    <script src="assets/javascripts/plugins/flot/jquery.flot.resize.js"></script>
    <script src="http://api.autodevbot.com/socket.io/socket.io.js" type="text/javascript"></script>    
    <script>
        socketIO = io.connect('http://api.autodevbot.com/');          

        socketIO.on('data', function (data) {
            console.log(data);
        });

        socketIO.on('error', function (reason){
            console.error('Unable to connect Socket.IO', reason);
        });

        socketIO.on('connect', function (){
            console.info('successfully established a working and authorized connection');
        });

        socketIO.emit('getTopLevelDashboardData');
        socketIO.emit('getMonitoringEvents');
    </script>
    <script type="text/javascript">
    $(document).ready(function() {

    /**
     * Builds initial array with the given number to build initial chart
     * before data comes back from the websocket call.
     *
     * @param {int} initialCount
     * @returns {Array}
     */
    function getInitTimeChartData(initialCount){
        var res = [];

        for(var i=1; i < initialCount; i++){
            res.push([i, 0]);
        }
        return res;
    }

    /**
     * Update entire chart array with the one new data point.
     *
     * @param {Array} chartData
     * @param {int} dataPoint
     * @returns {Array}
     */
    function updateTimeChartWithNewDataPoint(chartData, dataPoint){
        var res = [];

        var obj = $.parseJSON(dataPoint);
        console.log(obj.Success, obj.Failure);
        //console.log(chartData[0][1][0]);
        //console.log(chartData[0][1][1]);

        // Push all but the first one into the output array
        for(var i=1; i < chartData[0].length; i++){
            //res.push([chartData[0][i][0], chartData[0][i][1]]);
            res.push([i, chartData[0][i][1]]);
        }

        // Last plot on the left
        res.push([chartData[0].length, dataPoint]);

        //console.log(res);

        return res;
    }

    /**
     * Find the max Y axis in the chartData
     *
     * @param {Array} chartData
     * @returns {number}
     */
    function getMaxYAxis(chartData){
        var max = 0;
        for(var i=1; i < chartData[0].length; i++){
            if(chartData[0][i][1] > max)
                max = chartData[0][i][1];
        }
        return max;
    }        
    
      if($("#realtimechart").length) {
          var options = {
              series: { shadowSize: 1 },
              lines: { fill: true, fillColor: { colors: [ { opacity: 1 }, { opacity: 0.1 } ] }},
              yaxis: { min: 0, max: 1 },
              xaxis: { show: false },
              colors: ["#F4A506"],
              grid: { tickColor: "#dddddd",
                  borderWidth: 0
              }
          };

          var chartData = [getInitTimeChartData(299)];
          console.log(chartData);

          var plot = $.plot($("#realtimechart"), chartData, options);
          //var x = chartData;
          //console.log(x);
          // socket.on('statistic_eps_stat_auth_token', function(data){ // add new socket
          socketIO.on('getTopLevelDashboardData_stat', function(data){            
              console.log(data);
              chartData = [updateTimeChartWithNewDataPoint(chartData, data)]; // data.data

              // Setup and re-draw y axis with max value in current chart
              plot.getOptions().yaxes[0].max = getMaxYAxis(chartData);
              plot.setupGrid();

              plot.setData(chartData);
              plot.draw();
          });
      }

    });
    </script>
    
    <script type="text/javascript">
        // $(function () {
        //     // jQuery Flot Chart
        //     var visits = [[1, 50], [2, 40], [3, 45], [4, 23],[5, 55],[6, 65],[7, 61],[8, 70],[9, 65],[10, 75],[11, 57],[12, 59]];
        //     var visitors = [[1, 25], [2, 50], [3, 23], [4, 48],[5, 38],[6, 40],[7, 47],[8, 55],[9, 43],[10,50],[11,47],[12, 39]];

        //     var plot = $.plot($("#statsChart"),
        //         [ { data: visits, label: "Failures"},
        //          { data: visitors, label: "Incidents" }], {
        //             series: {
        //                 lines: { show: true,
        //                         lineWidth: 1,
        //                         fill: true, 
        //                         fillColor: { colors: [ { opacity: 0.1 }, { opacity: 0.13 } ] }
        //                      },
        //                 points: { show: true, 
        //                          lineWidth: 2,
        //                          radius: 3
        //                      },
        //                 shadowSize: 0,
        //                 stack: true
        //             },
        //             grid: { hoverable: true, 
        //                    clickable: true, 
        //                    tickColor: "#f9f9f9",
        //                    borderWidth: 0
        //                 },
        //             legend: {
        //                     // show: false
        //                     labelBoxBorderColor: "#fff"
        //                 },  
        //             colors: ["#a7b5c5", "#8ca252"],
        //             xaxis: {
        //                 ticks: [[1, "JAN"], [2, "FEB"], [3, "MAR"], [4,"APR"], [5,"MAY"], [6,"JUN"], 
        //                        [7,"JUL"], [8,"AUG"], [9,"SEP"], [10,"OCT"], [11,"NOV"], [12,"DEC"]],
        //                 font: {
        //                     size: 12,
        //                     family: "Open Sans, Arial",
        //                     variant: "small-caps",
        //                     color: "#697695"
        //                 }
        //             },
        //             yaxis: {
        //                 ticks:3, 
        //                 tickDecimals: 0,
        //                 font: {size:12, color: "#9da3a9"}
        //             }
        //          });

        //     function showTooltip(x, y, contents) {
        //         $('<div id="tooltip">' + contents + '</div>').css( {
        //             position: 'absolute',
        //             display: 'none',
        //             top: y - 30,
        //             left: x - 50,
        //             color: "#fff",
        //             padding: '2px 5px',
        //             'border-radius': '6px',
        //             'background-color': '#000',
        //             opacity: 0.80
        //         }).appendTo("body").fadeIn(200);
        //     }

        //     var previousPoint = null;
        //     $("#statsChart").bind("plothover", function (event, pos, item) {
        //         if (item) {
        //             if (previousPoint != item.dataIndex) {
        //                 previousPoint = item.dataIndex;

        //                 $("#tooltip").remove();
        //                 var x = item.datapoint[0].toFixed(0),
        //                     y = item.datapoint[1].toFixed(0);

        //                 var month = item.series.xaxis.ticks[item.dataIndex].label;

        //                 showTooltip(item.pageX, item.pageY,
        //                             item.series.label + " of " + month + ": " + y);
        //             }
        //         }
        //         else {
        //             $("#tooltip").remove();
        //             previousPoint = null;
        //         }
        //     });
        // });
    </script>    
  </body>
</html>
