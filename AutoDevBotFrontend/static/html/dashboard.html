<!DOCTYPE html>
<!--[if lt IE 9]> <html class="lt-ie9" lang="en"> <![endif]-->
<!--[if !IE] -->
<html lang='en'>
  <!-- <![endif] -->
  <head>
    <title>AutoDevbot</title>
    <meta content='all' name='robots'>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='width=device-width, initial-scale=1.0' name='viewport'>
    <!--[if IE]> <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'> <![endif]-->
    <link href='assets/images/meta_icons/apple-touch-icon.png' rel='apple-touch-icon-precomposed'>
    <!-- / required stylesheets -->
    <link href="assets/stylesheets/bootstrap/bootstrap.min.css" media="all" rel="stylesheet" type="text/css" />
    <link href="assets/stylesheets/demo_table.css" media="all" id="colors" rel="stylesheet" type="text/css" />   
    <link href="assets/stylesheets/jquery.dataTables_themeroller.css" media="all" id="colors" rel="stylesheet" type="text/css" />   
    <link href="assets/stylesheets/jquery.dataTables.css" media="all" id="colors" rel="stylesheet" type="text/css" />    
    <link href="assets/stylesheets/jednotka_green.css" media="all" id="colors" rel="stylesheet" type="text/css" />
    <link href="assets/stylesheets/dashboard.css" media="all" id="colors" rel="stylesheet" type="text/css" />    
    <!--[if lt IE 9]>
      <script src="assets/javascripts/ie/html5shiv.js" type="text/javascript"></script>
      <script src="assets/javascripts/ie/respond.min.js" type="text/javascript"></script>
    <![endif]-->
  </head>
  <body>
    <div id='wrapper'>
      <header id='header'>
        <div class='container'>
          <nav class='navbar navbar-default' id='nav' role='navigation'>
            <div class='navbar-header'>
              <button class='navbar-toggle' data-target='.navbar-header-collapse' data-toggle='collapse' type='button'>
                <span class='sr-only'>Toggle navigation</span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
                <span class='icon-bar'></span>
              </button>
              <a class='navbar-brand' href='index.html'>
                <img alt="AutoDevBotLogo" src="assets/images/AutoDevBot.com_logo.png" />
              </a>
            </div>
            <div class='collapse navbar-collapse navbar-header-collapse'>
              <ul class='nav navbar-nav navbar-right'>
                <li class='dropdown'>
                  <a class='dropdown-toggle' data-delay='50' data-hover='dropdown' data-toggle='dropdown' href='#'>
                    <span>
                      Reports
                      <i class='fa-icon-angle-down'></i>
                    </span>
                  </a>
                  <ul class='dropdown-menu' role='menu'>
                    <li class=''>
                      <a href='reports.html'>Incident Reports</a>
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </nav>
        </div>
      </header>
      <div id='main' role='main'>
        <div id='main-content'>
          <div class='container'>

            <div class='row'>
              <div class='col-sm-12'>
                <div class='row'>
                  <div class='col-sm-12'>                  
                  <h2>Dashboard 
                  <small>Incidents Breakdown.</small>
                  </h2>                                      
                  <!-- <div class="dash-stats">
                    <div class="toolbar">
                      <a class="btn btn-link" href="#">
                        <span class="metric"  id="SuccessStat"></span>   
                        <span id="ds-green">Successes</span>                                             
                      </a>
                      <a class="btn btn-link" href="#">
                        <span class="metric" id="FailureStat"></span>
                        <span id="ds-red">Failures</span>                        
                      </a>
                      <div id="TopLevelDashboard"></div>
                      <div id="MonitoringEvents"></div>                                         
                    </div>                      
                  </div> -->

                    <!-- TEST TABLE -->
                    <div class="table-responsive">
                      <div id="tableholder">
                          <!--<span>Loading...</span>-->
                        <table class="table table-striped table-hover table-bordered" id="tableEvents">
                            <thead>
                            <tr>
                                <th>UID</th>
                                <th>Created On</th>
                                <th>Status</th>
                                <th>Name</th>
                                <th>Details</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div class='fade' id='scroll-to-top'>
          <i class='fa-icon-chevron-up'></i>
        </div>
      </div>
      <footer id='footer'>
        <div id='footer-main'>
          <div class='container'>
            <div class='row'>
              <div class='col-md-3 col-sm-6 info-box'>
                <div class='logo-container'>
                  <img alt="AutoDevBotLogo" width="217" height="55" src="assets/images/AutoDevBot.com_logo.png" />
                </div>
                <p class='no-mg-b'>We are avid DevOps people making automated tools to make our lives easier and hopefully making your lives easier also.</p>
              </div>
              <div class='col-md-3 col-sm-6 info-box'>
              </div>
              <div class='col-md-3 col-sm-6 info-box social-box'>
              </div>
              <div class='col-md-3 col-sm-6 info-box'>
              </div>
            </div>
          </div>
        </div>
        <div id='footer-copyright'>
          <div class='container'>
            <div class='row'>
              <div class='col-lg-12 clearfix'>
                <p class='copyright'>
                  Copyright
                  &copy;
                  2013 AutoDevBot
                </p>
                <div class='links'>
                  <a class='btn btn-circle btn-medium-light btn-sm' href='#'>
                    <i class='fa-icon-twitter text-dark'></i>
                  </a>
                  <a class='btn btn-circle btn-medium-light btn-sm' href='#'>
                    <i class='fa-icon-dribbble text-dark'></i>
                  </a>
                  <a class='btn btn-circle btn-medium-light btn-sm' href='#'>
                    <i class='fa-icon-facebook text-dark'></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal -->
<div class="modal fade" id="incidentDetails" tabindex="-1" role="dialog" aria-labelledby="incidentDetailsLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="incidentDetailsLabel">Incident Details</h4>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <!-- <button type="button" class="btn btn-primary">Save changes</button> -->
      </div>
    </div>
  </div>
</div>

      </footer>
    </div>
    <!-- / required js -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="assets/javascripts/jquery/jquery.mobile.custom.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/bootstrap/bootstrap.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/plugins/modernizr/modernizr.custom.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/plugins/hover_dropdown/twitter-bootstrap-hover-dropdown.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/plugins/validate/jquery.validate.min.js" type="text/javascript"></script>
    <script src="assets/javascripts/jednotka.js" type="text/javascript"></script>
    <!-- angular -->
    <script src="assets/javascripts/angular/angular.js"></script>
    <!-- socketio -->  
    <script src="http://api.autodevbot.com/socket.io/socket.io.js" type="text/javascript"></script>
    <script type="text/javascript">
        socketIO = io.connect('http://api.autodevbot.com');

        socketIO.on('connect', function(data){
            setStatus('connected');
            socketIO.emit('subscribe-event-stream', {channel:'https://github.com/AutoDevBot/monitor-examples.git'});
        });

        socketIO.on('reconnecting', function(data){
            setStatus('reconnecting');
        });        

        socketIO.on('message', function (data) {
            // console.log('received a message: ', data);
            var ss = $.parseJSON(data);
            var rowColor = '';

            if(ss.testStatus.toLowerCase()=='failure' | ss.testStatus.toLowerCase()=='incomplete'){
                rowColor = ' danger ';
                $('#tableEvents').prepend('<tr class="'+rowColor+'" data-toggle="modal" dataid="'+ss.id+'" data-target="#incidentDetails"><td>'+ss.id+'</td><td>'+ss.createdOn+'</td><td>'+ss.testStatus+'</td><td>'+ss.testResultJSON.testsuites.testsuite[0].$.name+'</td><td>'+ss.testResultJSON.testsuites.testsuite[0].testcase[0].failure+'</td></tr>');
            }
            if(ss.testStatus.toLowerCase()=='success' | ss.testStatus.toLowerCase()=='completed'){
                rowColor = ' success ';
                $('#tableEvents').prepend('<tr class="'+rowColor+'" data-toggle="modal" dataid="'+ss.id+'" data-target="#incidentDetails"><td>'+ss.id+'</td><td>'+ss.createdOn+'</td><td>'+ss.testStatus+'</td><td>'+ss.testResultJSON.testsuites.testsuite[0].$.name+'</td><td></td></tr>');
            }
            if(ss.testStatus.toLowerCase()=='unknown')
                rowColor = ' warning ';

            // Prune table
            var rowCount = $('#tableEvents tr').length;
            console.log('rowCount: '+rowCount);
            $("#tableEvents tr:eq(11)").remove();

        });

        function setStatus(msg) {
            console.log('Connection Status : ' + msg);
        }        

    </script>
<!--     // <script type="text/javascript" src="http://ajax.aspnetcdn.com/ajax/jquery.dataTables/1.9.4/jquery.dataTables.js"></script> -->
    <script>
        // $(function(){
        //     $('#incidentDetails').modal({
        //         keyboard: true,
        //         backdrop: "static",
        //         show:false,
                
        //     }).on('show', function(){
        //           var getIdFromRow = $(event.target).closest('tr').data('id');
        //           console.log(getIdFromRow);
        //         //make your ajax call populate items or what even you need
        //         $(this).find('#orderDetails').html($('<b  Order Id selected: ' + getIdFromRow  + '</b>'))
        //     });
        // });
    </script>
  </body>
</html>
